{
  "hash": "6cce933e5e917266a9f5acfc45b3a614",
  "result": {
    "markdown": "---\ntitle: \"El trono en Ponceano: Liga de Quito en cifras con R\"\nauthor: \"Daniel S치nchez\"\ndate: \"2023-10-25\"\ndescription: \"Liga Deportiva Universitaria demuestra una vez m치s su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial.\"\ncategories: [spanish, ecuador, football, data viz, R]\nwebsite:\n  twitter-card:\n    image: dalle.png\n    creator: \"@daniel_ec18\"\ncsl: ../../econometrics.csl\nimage: dalle.png\nknitr:\n  opts_chunk: \n    message: false\n    warning: false\n    echo: true\n    include: true\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show the code\"\n    code-overflow: wrap\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Preliminares\n\n# Cargar librerias\n\nlibrary(worldfootballR)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(showtext)\n\n# Definir tema base\n\nfont_add_google(\"Questrial\", family = \"Questrial\")\nshowtext_auto()\n\ntheme_daniel<-\n  theme_hc(style = 'darkunica',\n           base_family = 'Questrial',\n           base_size = 40) +\n  theme(axis.line.y = element_line(colour = 'white'),\n        axis.line.x = element_blank(),\n        panel.grid.major.y = element_blank(),\n        panel.grid.major.x = element_blank(),\n        plot.caption = element_text(hjust = 0, face = 'italic'),\n        plot.title.position = 'plot',\n        plot.caption.position = 'plot',\n        plot.subtitle = element_text(lineheight = 0.5, vjust = 0.5),\n        axis.ticks = element_blank(),\n        plot.title = element_text(size = 60),\n        axis.text = element_text(colour = 'gray'))\n```\n:::\n\n\nDespu칠s de casi 14 a침os desde su 칰ltima final en un campeonato internacional, Liga Deportiva Universitaria de Quito (LDU) sell칩 su pase a la final de la Copa Sudamericana (el segundo campeonato m치s importante del f칰tbol de clubes en Sudam칠rica) derrotando al Defensa y Justicia argentino por goleada. El triunfo de Liga no viene f치cil: aunque se gan칩 el apodo de *Rey de Copas* por los cuatro t칤tulos internacionales ganados durante 2007-2010 (incluyendo la Copa Libertadores, el t칤tulo m치s importante de Am칠rica, nunca antes ganado por otro equipo ecuatoriano), al equipo le ha costado restaurar su gloria desde entonces.\n\nEl 28 de Octubre del 2023 Liga promete desempolvar el trono en Ponceano enfrentandose en Montevideo, Uruguay ante Fortaleza, equipo recientemente ascendido a la Serie A Brasileirao. En homenaje al equipo y en la misma l칤nea de los otros art칤culos de este blog, en este post reviso la trayectoria de Liga en campeonatos internacionales de f칰tbol, aprovechando la oportunidad para explorar las posibilidades de extracci칩n de datos de f칰tbol con R.\n\n\n::: {.cell hash='ldu_cache/html/extraccion-datos_0be9c4c5576d213d274a2e8f31565209'}\n\n```{.r .cell-code}\n# Loop para extraer informacion-copa-sudamericana\n\nlibertadores_matches_raw <- load_match_comp_results('Copa Libertadores de Am칠rica')\n\nsudamericana_matches_raw <- load_match_comp_results('Copa Sudamericana')\n\n# Preparar datos de Copa Libertadores\n\nlibertadores_matches <-\n  libertadores_matches_raw  %>% \n  janitor::clean_names()  %>%\n  transmute(competition_name = iconv(competition_name, from = \"UTF-8\", to = \"latin1\"),\n            year = season_end_year,\n            round,\n            round_number = case_when(\n              round == 'First stage' ~ 1,\n              round %in% c('Second stage', 'Group stage') ~ 2,\n              round == 'Knockout round play-offs' ~ 3,\n              round == 'Round of 16' ~ 5,\n              round == 'Quarter-finals' ~ 7,\n              round == 'Semi-finals' ~ 9,\n              round %in% c('Final', 'Finals') ~ 11\n            ),\n            day,\n            date,\n            time,\n            home_team_country = str_sub(home, start = -2)  %>% str_to_upper(),\n            home_team_name = str_sub(home, end = -4),\n            home_goals,\n            away_team_country = str_sub(away, start = 1, end = 2)  %>% str_to_upper(),\n            away_team_name = str_sub(away, start = 4, end = -1),\n            away_goals,\n            result = case_when(\n              home_goals > away_goals ~ 'home_win',\n              home_goals < away_goals ~ 'away_win',\n              home_goals == away_goals ~ NA),\n            match_winner = case_when(\n              home_goals > away_goals ~ home_team_name,\n              home_goals < away_goals ~ away_team_name,\n              home_goals == away_goals ~ 'none-draw'),\n            leg = case_when(\n              notes  %>% str_like('%Leg 1%') ~ 'leg_1',\n              notes  %>% str_like('%Leg 2%') ~ 'leg_2',\n              TRUE ~ NA\n            ),\n            penalty_kicks = if_else(notes  %>% str_like('%penalties%'), TRUE, FALSE),\n            extra_time = if_else(notes  %>% str_like('%extra time%'), TRUE, FALSE),\n            venue,\n            attendance,\n            referee,\n            notes)\n\n# Preparar datos de Copa Sudamericana\n\nsudamericana_matches <-\n  sudamericana_matches_raw  %>% \n  janitor::clean_names()  %>% \n  transmute(competition_name,\n            year = season_end_year,\n            round,\n            round_number = case_when(\n              round == 'First stage' ~ 1,\n              round %in% c('Second stage', 'Group stage') ~ 2,\n              round == 'Knockout round play-offs' ~ 3,\n              round == 'Round of 16' ~ 5,\n              round == 'Quarter-finals' ~ 7,\n              round == 'Semi-finals' ~ 9,\n              round %in% c('Final', 'Finals') ~ 11\n            ),\n            day,\n            date,\n            time,\n            home_team_country = str_sub(home, start = -2)  %>% str_to_upper(),\n            home_team_name = str_sub(home, end = -4),\n            home_goals,\n            away_team_country = str_sub(away, start = 1, end = 2)  %>% str_to_upper(),\n            away_team_name = str_sub(away, start = 4, end = -1),\n            away_goals,\n            result = case_when(\n              home_goals > away_goals ~ 'home_win',\n              home_goals < away_goals ~ 'away_win',\n              home_goals == away_goals ~ NA),\n            match_winner = case_when(\n              home_goals > away_goals ~ home_team_name,\n              home_goals < away_goals ~ away_team_name,\n              home_goals == away_goals ~ 'none-draw'),\n            leg = case_when(\n              notes  %>% str_like('%Leg 1%') ~ 'leg_1',\n              notes  %>% str_like('%Leg 2%') ~ 'leg_2',\n              TRUE ~ NA\n            ),\n            penalty_kicks = if_else(notes  %>% str_like('%penalties%'), TRUE, FALSE),\n            extra_time = if_else(notes  %>% str_like('%extra time%'), TRUE, FALSE),\n            venue,\n            attendance,\n            referee,\n            notes)\n\n# Filtrar para datos de LDU en Copa Libertadores solamente\n\nlibertadores_matches_ldu <-\n  libertadores_matches  %>% \n  filter(home_team_name == 'LDU de Quito' | away_team_name == 'LDU de Quito')\n\n# Obtener la ultima etapa alcanzada para cada a침o de LDU\n\nldu_stage_reached_libertadores <-\n  libertadores_matches_ldu  %>% \n  group_by(year)  %>% \n  summarise(stage_reached_libertadores = max(round_number, na.rm = T))\n\n# Filtrar para datos de LDU en Copa Sudamericana solamente\n\nsudamericana_matches_ldu <-\n  sudamericana_matches  %>%\n  filter(home_team_name == 'LDU de Quito' | away_team_name == 'LDU de Quito')\n\n# Obtener la ultima etapa alcanzada para cada a침o de LDU\n\nldu_stage_reached_sudamericana <-\n  sudamericana_matches_ldu  %>% \n  group_by(year)  %>%\n  summarise(stage_reached_sudamericana = max(round_number, na.rm = T))\n\n# Crear data frame para realizar grafico de resultados LDU en campeonatos internacionales \n\ninternational_results_ldu <-\n  ldu_stage_reached_libertadores  %>%\n  complete(year = seq(2014, 2023))  %>%\n  replace_na(list(stage_reached_libertadores = 0.1))  %>%\n  mutate(tournament = 'Libertadores')  %>%\n  rename(stage_reached = stage_reached_libertadores) %>% \n  bind_rows(\n    ldu_stage_reached_sudamericana  %>%\n      complete(year = seq(2014, 2023))  %>%\n      replace_na(list(stage_reached_sudamericana = 0.1))  %>%\n      mutate(tournament = 'Sudamericana') %>% \n      rename(stage_reached = stage_reached_sudamericana)\n  ) %>% \n  mutate(label = case_when(\n    .default = '',\n    stage_reached %in% c(1,2) ~ 'Grupos',\n    stage_reached == 3 ~ 'Repechaje',\n    stage_reached == 5 ~ 'Octavos de final',\n    stage_reached == 7 ~ 'Cuartos de final',\n    stage_reached == 9 ~ 'Semifinal',\n    stage_reached == 11 ~ 'Final'))\n```\n:::\n\n\nExisten varias referencias que describen la implementaci칩n de m칠todos de *football analytics*, sin embargo el problema aparece cuando se quiere implementar los m칠todos para el Ecuador. De forma decepcionante (aunque quiz치s no sorprendente), **no existe una autoridad que provea datos oficiales de la LigaPro Ecuador**. Existen algunas p치ginas web que proveen datos b치sicos, con especial atenci칩n al esfuerzo de [\\@mifutbolecuador](https://twitter.com/mifutbolecuador), sin embargo, no es posible encontrar una fuente que permita descargas. Curiosamente, sucede lo mismo para los campeonatos internacionales CONMEBOL: aunque existe m치s informaci칩n disponible, es complicado llegar a una base de datos limpia y descargable. Esto quiz치s se debe al potencial uso monetario de estos datos dada la existencia de la industria de las apuestas deportivas (especialmente importante en Ecuador).\n\nVentajosamente, existen esfuerzos internacionales que recientemente han empezado a recopilar informaci칩n sobre equipos ecuatorianos. Uno es [FBref.com](https://fbref.com/en/about/), un sitio web que provee datos de f칰tbol de todo el mundo. Otro sitio web similar es [Transfermarkt](https://www.transfermarkt.com/). La informaci칩n de ambos sitios web es de libre acceso, aunque no es posible descargar los datos directamente desde la p치gina web. Sin embargo, su existencia que permiten una t칠cnica com칰n de recolecci칩n de datos: *web scraping*. El scraping puede ser un problema por varias razones, ya que requiere entender las estructuras de datos de la p치gina web para construir un c칩dgio de scraping robusto. Ventajosamente, R ofrece un atajo *excelente*: la librer칤a *worldfootballR* de [\\@JaseZiv](https://twitter.com/JaseZiv), que permite hacer scraping de forma f치cil autom치tica. Arriba utilic칠 esta librer칤a para acceder a datos pre-procesados de FBref para todos los partidos de Copa Libertadores[^1] y Sudamericana[^2] desde 2014 hasta 2023[^3].\n\n[^1]: La Copa Libertadores es el torneo de clubes m치s importante de Sudam칠rica, en donde clasifican los primeros equipos de las divisiones de clubes nacionales de cada pa칤s. Es an치logo a la Champions League en Europa.\n\n[^2]: La Copa Sudamericana es el segundo torneo mas importante del f칰tbol de clubes sudamericano, en donde clasifican clubes en posiciones intermedias de las divisiones nacionales. Es an치logo a la Europa League en Europa.\n\n[^3]: En este post, cuando me refiero a un a침o, realmente me refiero a una *temporada*. Las temporadas comienzan el a침o anterior al indicado en las visualizaciones (por ejemplo, la temporada 2021 comienza en 2020 y termina en 2021).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Grafico de resultados LDU en campeonatos internacionales\n\ncolors <- c('Libertadores'= '#C7B143', 'Sudamericana' = '#20409A')\n\ninternational_results_ldu  %>%\n  filter(year > 2014) %>% \n  ggplot(aes(year, stage_reached, fill = tournament)) +\n  geom_col(width = 0.8, position = position_dodge(width = 0.8)) +\n  scale_fill_manual(values = colors) +\n  scale_x_continuous(breaks = seq(2014, 2023, 1)) +\n  annotate('text', x = 2015.2, y = 3.4, label = 'Octavos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2015.8, y = 1, label = 'Grupos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2017.2, y = 3.4, label = 'Octavos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2018.2, y = 3.4, label = 'Octavos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2018.8, y = 6, label = 'Cuartos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2019.8, y = 3.4, label = 'Octavos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2020.8, y = 1, label = 'Grupos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2021.2, y = 6, label = 'Cuartos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2022.2, y = 1, label = 'Grupos', size = 12, color = 'white', angle = 90) +\n  annotate('text', x = 2023.2, y = 10, label = 'Final', size = 12, color = 'white', angle = 90) +\n  labs(x = '',\n       y = '',\n       title = 'Resultados de copas internacionales para Liga de Quito',\n       subtitle = 'Copa Libertadores y Copa Sudamericana, 2015-2023',\n       fill = 'Campeonato',\n       caption = 'Nota: Valores sin etiqueta se presentan cuando LDU no particip칩 en el campeonato.')+\n  theme_daniel+\n  theme(axis.line.y = element_blank(),\n        axis.text.y = element_blank(),\n        legend.position = c(0.08, 0.88))\n```\n\n::: {.cell-output-display}\n![](ldu_files/figure-html/grafico-resultados-1.png){width=1152}\n:::\n\n```{.r .cell-code}\nggsave('grafico-resultados.png', width = 6, height = 6, dpi = 300)\n```\n:::\n\n\nNaturalmente, a Liga le ha costado m치s terminar en etapas avanzadas de Copa Libertadores que de Copa Sudamericana. El salto a la final de la Copa Sudamericana se da de forma abrupta: en 2022 no logra pasar de la etapa de grupos, pero en 2023 arrasa y llega a la final en Montevideo para enfrentarse a Fortaleza de Brasil, un equipo relativamente nuevo en la escena internacional al haber recientemente ascendido a la primera divisi칩n de Brasil.\n\nUna de las complicaciones de los datos (tanto en FBref como en Transfermarkt) es que el gr치fico solamente muestra una escena parcial de la historia de LDU en campeonatos internacionales. Lo m치s lejos que se puede observar es el resultado de Sudamericana en 2015, en donde Liga cay칩 ante River Plate tras un recordado [penal errado](https://www.youtube.com/watch?v=kXfFJ-mEBjk) por Jonathan 츼lvez, con Liga como anfitri칩n. No es posible observar los datos de la m칤tica Liga de los 2000, que gan칩 la Copa Libertadores y Sudamericana en 2008 y 2009 adem치s de dos Recopas[^4] en 2009 y 2010. Tampoco es posible observar el periodo posterior a 2010, en donde Liga de Quito no logr칩 clasificar a ning칰n torneo internacional hasta 2015.\n\n[^4]: Minitorneo en donde el campe칩n Libertadores se enfrenta al de Sudamericana. An치logo a la Super Cup en Europa\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extraer datos de partidos de Sudamericana para obtener Top Rivales de Liga en Sudamericana\n\nsudamericana_matches_ldu <-\n  sudamericana_matches %>% \n  filter(home_team_name == 'LDU de Quito' | away_team_name == 'LDU de Quito') %>% \n  transmute(year,\n            round,\n            date,\n            ldu_home_or_away = case_when(\n              home_team_name == 'LDU de Quito' ~ 'Home',\n              away_team_name== 'LDU de Quito' ~ 'Away'),\n            opponent = case_when(\n              home_team_name == 'LDU de Quito' ~ away_team_name,\n              away_team_name == 'LDU de Quito' ~ home_team_name),\n            opponent_country = case_when(\n              home_team_name == 'LDU de Quito' ~ away_team_country,\n              away_team_name == 'LDU de Quito' ~ home_team_country),\n            ldu_goals = case_when(\n              home_team_name == 'LDU de Quito' ~ home_goals,\n              away_team_name == 'LDU de Quito' ~ away_goals),\n            opponent_goals = case_when(\n              home_team_name == 'LDU de Quito' ~ away_goals,\n              away_team_name == 'LDU de Quito' ~ home_goals),\n            ldu_result = case_when(\n              ldu_goals > opponent_goals ~ 'Win',\n              ldu_goals < opponent_goals ~ 'Loss',\n              ldu_goals == opponent_goals ~ 'Draw'),\n            tournament = 'Sudamericana',\n            )\n\n# Hacer lo mismo para Libertadores\n\nlibertadores_matches_ldu <-\n  libertadores_matches %>% \n  filter(home_team_name == 'LDU de Quito' | away_team_name == 'LDU de Quito') %>% \n  transmute(year,\n            round,\n            date,\n            ldu_home_or_away = case_when(\n              home_team_name == 'LDU de Quito' ~ 'Home',\n              away_team_name== 'LDU de Quito' ~ 'Away'),\n            opponent = case_when(\n              home_team_name == 'LDU de Quito' ~ away_team_name,\n              away_team_name == 'LDU de Quito' ~ home_team_name),\n            opponent_country = case_when(\n              home_team_name == 'LDU de Quito' ~ away_team_country,\n              away_team_name == 'LDU de Quito' ~ home_team_country),\n            ldu_goals = case_when(\n              home_team_name == 'LDU de Quito' ~ home_goals,\n              away_team_name == 'LDU de Quito' ~ away_goals),\n            opponent_goals = case_when(\n              home_team_name == 'LDU de Quito' ~ away_goals,\n              away_team_name == 'LDU de Quito' ~ home_goals),\n            ldu_result = case_when(\n              ldu_goals > opponent_goals ~ 'Win',\n              ldu_goals < opponent_goals ~ 'Loss',\n              ldu_goals == opponent_goals ~ 'Draw'),\n            tournament = 'Libertadores')\n\n# Unir dataframes y obtener totales de goles a favor y en contra para cada a침o y por cada torneo\n\nldu_match_goals <-\n  bind_rows(sudamericana_matches_ldu, libertadores_matches_ldu) %>% \n  group_by(year, tournament) %>% \n  summarise(ldu_goals = sum(ldu_goals, na.rm = TRUE),\n            opponent_goals = sum(opponent_goals, na.rm = TRUE),\n            ldu_wins = sum(ldu_result == 'Win', na.rm = TRUE),\n            ldu_losses = sum(ldu_result == 'Loss', na.rm = TRUE),\n            ldu_draws = sum(ldu_result == 'Draw', na.rm = TRUE),\n            total_matches = n()) %>% \n  mutate(ldu_goal_difference = ldu_goals - opponent_goals,\n         ldu_win_percentage = ldu_wins / total_matches * 100) %>% \n  arrange(year, tournament) %>% \n  ungroup()\n\n\n# Graficar \n\nldu_match_goals %>% \n  select(year, tournament, ldu_goals, opponent_goals) %>%\n  pivot_longer(c(ldu_goals, opponent_goals),\n               names_to = 'goals_from',\n               values_to = 'goals') %>%\n  mutate(goals_from = case_when(\n    goals_from == 'ldu_goals' ~ 'A favor',\n    goals_from == 'opponent_goals' ~ 'En contra')) %>%\n  ggplot(aes(x = year, y = goals, fill = goals_from)) +\n  geom_col(position = 'dodge') +\n  scale_x_continuous(breaks = seq(2015, 2023, 1)) +\n  scale_fill_manual(values = c('#20409A', '#EE2E24')) +\n  facet_wrap(~tournament) +\n  labs(title = 'Goles a favor y en contra de LDU',\n       subtitle = 'Torneos internacionales 2015-2023',\n       x = '',\n       y = 'Goles',\n       fill = '',\n       caption = str_wrap('Nota: se presentan goles a favor y en contra solo en casos en donde LDU clasific칩 y particip칩 en al menos en un partido. Datos de FBref.', 120)) +\n  theme_daniel +\n  theme(axis.line.x = element_line(color = 'white'),\n        panel.background = element_rect(colour = \"white\", linewidth=4, fill=NA),\n        axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1),\n        axis.ticks = element_line(colour = 'white'),\n        legend.position = c(0.9,1.18))\n```\n\n::: {.cell-output-display}\n![](ldu_files/figure-html/datos-partidos-1.png){width=1152}\n:::\n:::\n\n\nLos datos preprocesados de *worldfootballR* permiten calcular el n칰mero de goles a favor y en contra para cada una de las temporadas de LDU en torneos internacionales. Naturalmente, el equipo ha mejorado su ratio de goles a medida que ha ido pasando a etapas m치s avanzadas del torneo y como es de esperarse, Liga es m치s capaz de mantener su arco en cero en la Sudamericana que en la Libertadores. El mejor desempe침o de LDU en la Sudamericana se da este a침o, con 23 goles en 14 partidos, lo que representa un 50% de partidos ganados. Esto, sin embargo, no es el mejor record de LDU en torneos internacionales de los 칰ltimos a침os: en 2020, aunque el equipo solo pas칩 a octavos de final, logr칩 un 62.5% de partidos ganados en Copa Libertadores. Esto es un claro ejemplo de c칩mo la estad칤stica simple no deber칤a ser malinterpretada en contextos deportivos como este.\n\nSin embargo, hay indicadores que rara vez fallan, y uno de ellos es \\$ *la plata* \\$. 쮺u치nto invirti칩 Liga de Quito en los 칰ltimos a침os para llegar donde est치 el d칤a de hoy? Esta pregunta podr칤a parecer extremadamente complicada de responder, pero los datos de Transfermarkt, plataforma alemana conocida por su exactitud en cuanto a informaci칩n de traspasos y valor de jugadores, lo facilita. La funci칩n que permite obtener esta informaci칩n permite solamente observar un a침o a la vez, por lo que utilizo un `for` *loop* ([aunque muy temidos en R, los loops son manejables](loops.jpg)) para obtener la informaci칩n de los 칰ltimos a침os sin tener que llamar la funci칩n una y otra vez.\n\n\n::: {.cell hash='ldu_cache/html/ldu-finances_fe090d9e9cffe64c06251835cfa1e1f9'}\n\n```{.r .cell-code}\n# El campeonato ecuatoriano est치 distribuido en dos diferentes links de Transfermarkt, es necesario crear un foroop para cada uno: \n\n# Vector de a침os para el loop (2019-2022)\n\nyears_1 <- 2019:2023\n\n# Inicializar una lista para guardar los resultados de cada iteracion del loop\n\necuador_finances1 <- list()\n\nfor (i in years_1){\n  ecuador_finances1[[which(years_1 == i)]] <- tm_team_transfer_balances('ECU', \n                                                                     i, \n                                                                     league_url = 'https://www.transfermarkt.com/ligapro-serie-a-primera-etapa/startseite/wettbewerb/EL1A') %>% \n    mutate(year = i) # Agregar a침o para cada iteracion\n}\n\n# El siguiente loop requiere tanto el link como el a침o, definir los vectores a continuacion\n\n# Siguiente link: 2012-2018\n\nyears_2 <- 2012:2018\n\nlinks <- c(\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2011',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2012',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2013',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2014',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2015',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2016',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2017',\n  'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2018'\n)\n\necuador_finances2 <- list()\n\nfor (i in 1:length(years_2)){\n ecuador_finances2[[years_2[i]]] <- tm_team_transfer_balances('ECU', years_2[i], league_url = links[i]) %>% \n                                    mutate(year = years_2[i]) \n}\n\n# Extraer informacion a un dataframe y limpiar datos:\n\necuador_finances_full <-\n  bind_rows(ecuador_finances1, ecuador_finances2) \n\n# Filtrar para solo LDU, calcular ingresos-egresos y graficar en un grafico de barras\n\necuador_finances_full %>% \n  filter(squad == 'LDU Quito') %>% \n  transmute(year, \n            income = income_euros, \n            expenditure = -expenditure_euros) %>% \n  pivot_longer(c(income, expenditure),\n               names_to = 'balance_type',\n               values_to = 'values') %>% \n  mutate(balance_type = if_else(balance_type == 'income', 'Ingresos', 'Egresos')) %>% \n  ggplot(aes(as.factor(year), values/1000000, fill = balance_type, group = balance_type)) + \n  geom_col(position = 'dodge')+\n  scale_fill_manual(values = c('Ingresos' = '#20409A', 'Egresos' = '#EE2E24')) +\n  scale_y_continuous(labels = scales::comma, breaks = seq(0, 6, by = 2)) +\n  geom_hline(yintercept = 0, color = 'gray40', linewidth = 1) +\n  labs(title = 'Ingresos y egresos para Liga de Quito',\n       subtitle = 'Cifras de traspasos 2012-2022',\n       x = '',\n       y = 'Miles de euros',\n       fill = '',\n       caption = str_wrap('Nota: 2023 es un a침o parcial. No se presentan datos para las temporadas donde no se registran jugadores vendidos. Datos de Transfemarkt.', 115)) +\n  theme_daniel +\n  theme(axis.line.x = element_line(color = 'white'),\n        panel.background = element_rect(colour = \"white\", linewidth=4, fill = NA),\n        axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1),\n        axis.ticks = element_line(colour = 'white'),\n        legend.position = c(0.85,1.1))\n```\n\n::: {.cell-output-display}\n![](ldu_files/figure-html/ldu-finances-1.png){width=1152}\n:::\n:::\n\n\nEn 2022 LDU tuvo la mejor temporada en t칠rminos de ingresos por traspasos de su historia, logrando vender jugadores por 7.1 millones de euros[^5]. De forma notable, el club vendi칩 a dos jugadores por altos valores: Rodrigo Aguirre y Nilson Angulo, por 4.75 y 1.90 millones de euros. En 2022 LDU no invirti칩 dinero en su plantilla, sin embargo, logr칩 traer al equipo a varios agentes libres, situaci칩n que no se refleja en el gr치fico anterior, pero se puede visualizar en la p치gina web de Transfermarkt. Uno de los jugadores m치s importantes que llega a LDU como agente libre es Alexander Dom칤nguez, hist칩rico arquero de la selecci칩n ecuatoriana y LDU, que regresa al equipo luego de varios a침os en el exterior. Adicionalmente, las cifras no muestran los valores de contratos temporales, como es el de Renato Ibarra, mediocampista ecuatoriano, quien llega a LDU tras una larga carrera en el f칰tbol internacional. De todas formas, la inversi칩n en la plantilla de 2021 es la tercera m치s alta de los 칰ltimos 20 a침os, y los ingresos que LDU ha podido recolectar en 2022 y 2023 potencialmente le permitir치n seguir invirtiendo en su plantel existente, as칤 como en la infraestructura del club y las juveniles, que son lo que inicialmente hicieron al club lo que es hoy (y lo que ahora diferencia a Independiente del Valle, tambi칠n muy exitoso equipo ecuatoriano).\n\n[^5]: Esta es la moneda nativa de Transfermarkt.\n\nLejos de ser un ejercicio exhaustivo de an치lisis, lo que este post intenta hacer es dar una mirada aterrizada a las cifras del equipo en los dos torneos m치s importantes de la regi칩n. Es desafortunado que no exista una fuente de datos centralizada que permita analizar el f칰tbol ecuatoriano y regional m치s a fondo, sin embargo, las posibilidades que ofrecen los desarrolladores open source de R, como el paquete utilizado aqu칤, *worldfootballR*, son una muestra de que es posible hacer an치lisis de datos de f칰tbol de forma m치s accesible y transparente. Espero que este trabajo sea de utilidad para qui칠nes se interesen en extraer y analizar datos de f칰tbol latinoamericano en gran escala, y, ante todo, que sea un buen augurio para la quinta estrella del trono en Ponceano.\n\n> *Liga te pido ponga 游볰...*\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}